{{define "admin-contacts-archive-content"}}
    <div class="form-section contacts-archive">
        <h2>
        Архив заявок
        <span class="count-big">{{.total}}</span>
        </h2>

        <div class="filters contacts-toolbar">
        <!-- Поиск -->
        <input type="text" id="search-input" class="form-input" placeholder="Поиск" value="{{.search}}">

        <!-- Статус: только Архив, disabled -->
        <select id="status-filter" class="form-input" disabled>
            <option value="archived" selected>Архив</option>
        </select>

        <!-- Интервал дат -->
        <select id="date-filter" class="form-input">
            <option value="">Все даты</option>
            <option value="today" {{if eq .dateRange "today"}}selected{{end}}>Сегодня</option>
            <option value="7d" {{if eq .dateRange "7d"}}selected{{end}}>Последние 7 дней</option>
            <option value="month" {{if eq .dateRange "month"}}selected{{end}}>Этот месяц</option>
        </select>

        <!-- Селектор размера страницы -->
        <select id="limit-select" class="form-input">
            <option value="25" {{if eq .limit 25}}selected{{end}}>25</option>
            <option value="50" {{if eq .limit 50}}selected{{end}}>50</option>
            <option value="100" {{if eq .limit 100}}selected{{end}}>100</option>
        </select>

        <div class="toolbar-actions">
          <button id="apply-filters" class="btn btn-small btn-blue">Применить</button>
          <button id="export-csv" class="btn btn-small">Экспорт CSV</button>
          <a id="go-back"
            class="btn btn-small"
            href="/admin/contacts?{{if .search}}search={{.search}}&{{end}}{{if .dateRange}}date={{.dateRange}}&{{end}}{{if .limit}}limit={{.limit}}&{{end}}page=1">
            Назад
          </a>
        </div>

        </div>

        <!-- Панель массовых действий (архив) -->
        <div class="bulk-actions">
        <div class="bulk-actions__title">Действия с выбранными:</div>
        <button id="bulk-restore" class="btn btn-small btn-blue" disabled>Восстановить</button>
        <button id="bulk-delete" class="btn btn-small btn-danger" disabled>Удалить выбранные</button>
        <span id="bulk-count" class="muted bulk-count">Выбрано: 0</span>
        </div>

        <!-- Таблица -->
        <div class="table-wrapper">
        <table class="table contacts-table">
            {{template "contacts-table-head-archive" .}}

            <tbody>
                {{if .contactsAll}}
                    {{range .contactsAll}}
                    <tr data-id="{{.ID}}">
                        <td class="col-select">
                        <input type="checkbox" class="row-select" value="{{.ID}}" aria-label="Выбрать заявку {{.ID}}">
                        </td>

                        <td>{{.Name}}</td>

                        <td>
                        {{if .Phone}}<a href="tel:{{.Phone}}">{{.Phone}}</a>{{else}}—{{end}}
                        <div class="muted-email">{{.Email}}</div>
                        </td>

                        <td>{{.Company}}</td>
                        <td>{{translateProjectType .ProjectType}}</td>

                        <td class="date-cell">{{fmtTime .CreatedAt}}</td>

                        <td class="actions">
                        <button
                        class="btn btn-small js-contact-details"
                        type="button"
                        data-id="{{.ID}}"
                        data-name="{{.Name}}"
                        data-phone="{{.Phone}}"
                        data-email="{{.Email}}"
                        data-company="{{.Company}}"
                        data-type="{{translateProjectType .ProjectType}}"
                        data-message="{{.Message}}"
                        data-date="{{fmtTime .CreatedAt}}"
                        {{with .ArchivedAt}}data-archived='{{.Format "02.01.2006 15:04"}}'{{else}}data-archived=''{{end}}
                        data-status="{{.Status}}"
                        data-remind-at='{{with .RemindAt}}{{.Format "2006-01-02T15:04"}}{{end}}'
                        data-remind-flag='{{.RemindFlag}}'
                        >Подробнее</button>
                        </td>
                    </tr>
                    {{end}}
                {{else}}
                    <tr><td colspan="7" class="empty-message">Архив пуст</td></tr>
                {{end}}
            </tbody>

        </table>
        </div>

        <!-- Пагинация -->
        {{template "contacts-pagination-archive" .}}
    </div>
{{end}}

{{define "contacts-archive-modals"}}
    <div id="contact-details-modal" class="modal-overlay hidden" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="contactDetailsTitle">
        <button class="modal-close" type="button" aria-label="Закрыть">&times;</button>

        <h3 id="contactDetailsTitle">Заявка</h3>

        <div class="modal-body">
            <div class="tabs">
                <button id="tab-info-btn"  class="btn btn-small btn-blue" type="button">Информация</button>
                <button id="tab-notes-btn" class="btn btn-small"          type="button">Заметки</button>
            </div>

            <!-- TAB: Информация -->
            <div id="cd-tab-info">
                <div class="modal-grid">
                <div><strong>Имя:</strong> <span id="cd-name">—</span></div>
                <div><strong>Телефон:</strong> <a id="cd-phone" href="#" target="_blank">—</a></div>
                <div><strong>Email:</strong> <a id="cd-email" href="#" target="_blank">—</a></div>
                <div><strong>Компания:</strong> <span id="cd-company">—</span></div>
                <div><strong>Тип проекта:</strong> <span id="cd-type">—</span></div>
                <div><strong>Дата создания:</strong> <span id="cd-date">—</span></div>
                <div><strong>Дата архивации:</strong> <span id="cd-archived">—</span></div>
                </div>

                <div class="modal-message">
                <strong>Сообщение:</strong>
                <div id="cd-message" class="prewrap"></div>
                </div>

                <div class="modal-footer">
                <button id="cd-restore" class="btn btn-small btn-blue">Восстановить</button>
                <button id="cd-delete"  class="btn btn-small btn-danger">Удалить навсегда</button>
                </div>
            </div>

            <!-- TAB: Заметки -->
            <div id="cd-tab-notes" class="hidden">

                <div class="note-form">
                <ul id="cd-notes-list" class="notes-list"></ul>

                <div class="notes-controls">
                    <input id="cd-note-author" type="text" class="form-input note-author-input" placeholder="Автор (необязательно)">
                    <input id="cd-note-text"   type="text" class="form-input note-text-input" placeholder="Новая заметка...">
                    <button id="cd-note-add"   class="btn btn-small btn-blue" type="button">Добавить</button>
                </div>
                </div>
            </div>
            </div>
        </div>
    </div>
{{end}}

{{define "contacts-archive-extra-js"}}
    <script src="/static/js/admin-contacts-api.js" defer></script>
    <script src="/static/js/admin-contacts-ui.js" defer></script>
    <script src="/static/js/admin-contacts-shared.js" defer></script>
    <script src="/static/js/admin-contacts-archive-filters.js" defer></script>
    <script src="/static/js/admin-contacts-notes.js" defer></script>
    <script src="/static/js/admin-contacts-archive-modal.js" defer></script>
    <script src="/static/js/admin-contacts-archive-bulk.js" defer></script>
    <script src="/static/js/admin-contacts-archive-init.js" defer></script>
{{end}}
