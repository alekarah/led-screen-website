{{define "admin-projects-content"}}
<div class="form-section">
    <button class="btn" id="openCreateProjectModal">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
</div>
<!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
<div class="projects-list">
    <h2>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã</h2>
    <div id="sortable-projects" class="sortable-list">
        {{range .projects}}
        <div class="project-item" data-project-id="{{.ID}}">
            <div class="project-info">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span class="drag-handle" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞" role="button" aria-label="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å">‚ãÆ‚ãÆ</span>
                    
                    <!-- –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ -->
                    <div class="project-thumbnail">
                        {{if .Images}}
                            {{$firstImage := index .Images 0}}
                            <img src="/static/uploads/{{$firstImage.Filename}}" 
                                alt="{{.Title}}" 
                                style="transform: scale({{if $firstImage.CropScale}}{{$firstImage.CropScale}}{{else}}1{{end}})
                                                translate({{mul (sub $firstImage.CropX 50) 2}}%, {{mul (sub $firstImage.CropY 50) 2}}%);
                                        object-position: center center;
                                        transform-origin: center center;">
                        {{else}}
                            <div class="no-image">üì∑</div>
                        {{end}}
                    </div>
                    
                    <div>
                        <h3>{{.Title}}</h3>
                        <p>{{.Description}}</p>
                        <p><small>
                            –†–∞–∑–º–µ—Ä: {{.Size}} | –ü–∏–∫—Å–µ–ª—å: {{.PixelPitch}} | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {{len .Images}} | 
                            –ù–∞ –≥–ª–∞–≤–Ω–æ–π: {{if .Featured}}<span style="color: #4A90E2; font-weight: bold;">‚≠ê –î–∞</span>{{else}}<span style="color: #999;">–ù–µ—Ç</span>{{end}}
                        </small></p>
                    </div>
                </div>
            </div>
            <div class="project-actions">
                <button class="btn" onclick="editProject({{.ID}})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-danger" onclick="deleteProject({{.ID}})">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
        {{end}}
    </div>
</div>
{{end}}

{{define "project-modals"}}
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h2>
            <span class="close" onclick="closeEditModal()">&times;</span>
        </div>
        <form id="editProjectForm">
            <input type="hidden" id="edit_project_id">
            
            <div class="form-group">
                <label for="edit_title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:</label>
                <input type="text" id="edit_title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="edit_description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="edit_description" name="description"></textarea>
            </div>
            
            <div class="form-group">
                <label for="edit_location">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                <input type="text" id="edit_location" name="location">
            </div>
            
            <div class="form-group">
                <label for="edit_size">–†–∞–∑–º–µ—Ä:</label>
                <input type="text" id="edit_size" name="size">
            </div>
            
            <div class="form-group">
                <label for="edit_pixel_pitch">–®–∞–≥ –ø–∏–∫—Å–µ–ª—è:</label>
                <input type="text" id="edit_pixel_pitch" name="pixel_pitch">
            </div>
            
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                <div id="edit_categories" class="checkbox-group">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <div class="featured-checkbox">
                <input type="checkbox" id="edit_featured" name="featured">
                <label for="edit_featured">‚≠ê –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</label>
            </div>
            
            <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ -->
        <div class="upload-section">
            <h3>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞</h3>
            <div id="project_images" class="images-grid">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <form id="editUploadForm" method="post" enctype="multipart/form-data" style="margin-top: 1rem;">
                <input type="hidden" id="edit_upload_project_id" name="project_id">
                <div class="form-group">
                    <label for="edit_images">–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <input type="file" id="edit_images" name="images" multiple accept="image/*">
                </div>
                <button type="submit" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ -->
<div id="createProjectModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h2>
      <span class="close" onclick="closeCreateProjectModal()">&times;</span>
    </div>
    <form id="createProjectForm">
      <div class="form-group">
            <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:</label>
            <input type="text" id="title" name="title" required>
        </div>
        
        <div class="form-group">
            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="description" name="description"></textarea>
        </div>
        
        <div class="form-group">
            <label for="location">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
            <input type="text" id="location" name="location">
        </div>
        
        <div class="form-group">
            <label for="size">–†–∞–∑–º–µ—Ä:</label>
            <input type="text" id="size" name="size" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 12x5">
        </div>
        
        <div class="form-group">
            <label for="pixel_pitch">–®–∞–≥ –ø–∏–∫—Å–µ–ª—è:</label>
            <input type="text" id="pixel_pitch" name="pixel_pitch" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: P6.66">
        </div>
        
        <div class="form-group">
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
            <div class="checkbox-group">
                {{range .categories}}
                <div class="checkbox-item">
                    <input type="checkbox" id="cat_{{.ID}}" name="categories" value="{{.ID}}">
                    <label for="cat_{{.ID}}">{{.Name}}</label>
                </div>
                {{end}}
            </div>
        </div>
        
        <div class="featured-checkbox">
            <input type="checkbox" id="featured" name="featured">
            <label for="featured">‚≠ê –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</label>
        </div>
      <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
    </form>
  </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫—Ä–æ–ø–ø–∏–Ω–≥–∞ -->
<div id="cropModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
            <span class="close" onclick="closeCropModal()">&times;</span>
        </div>

        <div class="crop-editor">
            <div class="crop-preview">
                <img id="cropPreviewImage" src="" alt="–ü—Ä–µ–≤—å—é">
            </div>

            <div class="crop-controls">
                <div class="crop-control">
                    <label for="cropX">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ:</label>
                    <input type="range" id="cropX" min="0" max="100" value="50">
                    <div class="crop-value">–ó–Ω–∞—á–µ–Ω–∏–µ: <span id="cropXValue">50</span>%</div>
                </div>

                <div class="crop-control">
                    <label for="cropY">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ:</label>
                    <input type="range" id="cropY" min="0" max="100" value="50">
                    <div class="crop-value">–ó–Ω–∞—á–µ–Ω–∏–µ: <span id="cropYValue">50</span>%</div>
                </div>

                <div class="crop-control">
                    <label for="cropScale">–ú–∞—Å—à—Ç–∞–±:</label>
                    <input type="range" id="cropScale" min="0.5" max="3" step="0.1" value="1">
                    <div class="crop-value">–ó–Ω–∞—á–µ–Ω–∏–µ: <span id="cropScaleValue">1</span>x</div>
                </div>

                <div class="crop-actions">
                    <button type="button" class="btn" onclick="resetCrop()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    <button type="button" class="btn btn-success" onclick="saveCrop()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É -->
        <button type="button" class="crop-help-button" onclick="showKeyboardHelp()" title="–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏">
            ‚å®Ô∏è
        </button>
    </div>
</div>
{{end}}

{{define "projects-extra-js"}}
    <script src="/static/js/admin-projects-creation.js"></script>
    <script src="/static/js/admin-projects-editing.js"></script>
    <script src="/static/js/admin-projects-images.js"></script>
    <script src="/static/js/crop-editor-core.js"></script>
    <script src="/static/js/crop-editor-ui.js"></script>
    <script src="/static/js/crop-editor-presets.js"></script>
    <script src="/static/js/crop-editor-api.js"></script>
    <script src="/static/js/project-sorting.js"></script>

    <!-- SortableJS: –ª–æ–∫–∞–ª—å–Ω–æ + —Ç–∏—Ö–∏–π —Ñ–æ–ª–ª–±–µ–∫ –Ω–∞ CDN -->
    <script src="/static/js/vendor/Sortable.min.js"
            defer
            onerror="(function(){var s=document.createElement('script');s.src='https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js';s.defer=true;document.body.appendChild(s)})()">
    </script>

    <script src="/static/js/admin-projects-init.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        if (!window.__cropInited) {
            initCropUI();
            initCropKeyboardShortcuts();
            window.__cropInited = true;
        }
    });
    </script>
{{end}}