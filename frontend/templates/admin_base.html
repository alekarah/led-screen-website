<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>

    <!-- Общие стили админки -->
    <link rel="stylesheet" href="/static/css/admin-vars.css">
    <link rel="stylesheet" href="/static/css/admin-base.css">
    <link rel="stylesheet" href="/static/css/admin-dashboard.css">
    <link rel="stylesheet" href="/static/css/admin-contacts.css">
    <link rel="stylesheet" href="/static/css/admin-forms.css">
    <link rel="stylesheet" href="/static/css/admin-projects.css">
    <link rel="stylesheet" href="/static/css/admin-prices.css">
    <link rel="stylesheet" href="/static/css/admin-modals.css">
    <link rel="stylesheet" href="/static/css/crop-editor.css">

    <link rel="icon" type="image/png" href="/static/images/favicon-admin.png">

    <!-- Стили-«хуки» для отдельных страниц -->
    {{block "extra-css" .}}{{end}}
</head>
<body>
    <!-- Шапка -->
    <header class="header">
        <div class="container">
            <h1>Админ панель</h1>
            <nav aria-label="Основная навигация">
            <ul class="nav-links">
                <li><a href="/admin" {{if eq .PageID "admin-dashboard"}}aria-current="page"{{end}}>Главная</a></li>
                <li><a href="/admin/contacts" {{if eq .PageID "admin-contacts"}}aria-current="page"{{end}}>Заявки</a></li>
                <li><a href="/admin/projects" {{if eq .PageID "admin-projects"}}aria-current="page"{{end}}>Проекты</a></li>
                <li><a href="/admin/prices" {{if eq .PageID "admin-prices"}}aria-current="page"{{end}}>Цены</a></li>
                <li><a href="/admin/promo" {{if eq .PageID "admin-promo"}}aria-current="page"{{end}}>Акция</a></li>
                <li><a href="/admin/map-points" {{if eq .PageID "admin-map-points"}}aria-current="page"{{end}}>Карта</a></li>
                <li><a href="/">На сайт</a></li>
                <li><a href="/admin/logout" class="logout-link">Выход</a></li>
            </ul>
            </nav>
        </div>
    </header>


    <!-- Контент -->
    <main class="container">
        <div id="message"></div>

        {{if eq .PageID "admin-dashboard"}}
            {{template "admin-dashboard-content" .}}
        {{else if eq .PageID "admin-projects"}}
            {{template "admin-projects-content" .}}
        {{else if eq .PageID "admin-prices"}}
            {{template "admin-prices-content" .}}
        {{else if eq .PageID "admin-promo"}}
            {{template "admin-promo-content" .}}
        {{else if eq .PageID "admin-contacts"}}
            {{template "admin-contacts-content" .}}
        {{else if eq .PageID "admin-contacts-archive"}}
            {{template "admin-contacts-archive-content" .}}
        {{else if eq .PageID "admin-map-points"}}
            {{template "admin-map-points-content" .}}
        {{end}}
    </main>

    <!-- ВСТАВКА МОДАЛОК СТРОГО ПОСЛЕ КОНТЕНТА СТРАНИЦЫ -->
    {{if eq .PageID "admin-contacts"}}
        {{template "contacts-modals" .}}
    {{end}}
    {{if eq .PageID "admin-projects"}}
        {{template "project-modals" .}}
    {{end}}
    {{if eq .PageID "admin-prices"}}
        {{template "price-modals" .}}
    {{end}}
    {{if eq .PageID "admin-contacts-archive"}}
        {{template "contacts-archive-modals" .}}
    {{end}}
    {{if eq .PageID "admin-map-points"}}
        {{template "map-points-modals" .}}
    {{end}}

    <!-- Crop Editor Modal - используется на страницах проектов и цен -->
    {{if or (eq .PageID "admin-projects") (eq .PageID "admin-prices")}}
    <div id="cropModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Настройка отображения</h2>
                <span class="close" onclick="closeCropModal()">&times;</span>
            </div>

            <div class="crop-editor">
                <div class="crop-preview">
                    <img id="cropPreviewImage" src="" alt="Превью">
                </div>

                <div class="crop-controls">
                    <div class="crop-control">
                        <label for="cropX">Горизонтальное смещение:</label>
                        <input type="range" id="cropX" min="0" max="100" value="50">
                        <div class="crop-value">Значение: <span id="cropXValue">50</span>%</div>
                    </div>

                    <div class="crop-control">
                        <label for="cropY">Вертикальное смещение:</label>
                        <input type="range" id="cropY" min="0" max="100" value="50">
                        <div class="crop-value">Значение: <span id="cropYValue">50</span>%</div>
                    </div>

                    <div class="crop-control">
                        <label for="cropScale">Масштаб:</label>
                        <input type="range" id="cropScale" min="1" max="3" step="0.1" value="1">
                        <div class="crop-value">Значение: <span id="cropScaleValue">1</span>x</div>
                    </div>

                    <div class="crop-actions">
                        <button type="button" class="btn" onclick="resetCrop()">Сбросить</button>
                        <button type="button" class="btn btn-success" onclick="saveCrop()">Сохранить</button>
                    </div>
                </div>
            </div>

            <!-- Кнопка подсказки в правом нижнем углу -->
            <button type="button" class="crop-help-button" onclick="showKeyboardHelp()" title="Горячие клавиши">
                ⌨️
            </button>
        </div>
    </div>
    {{end}}

    <!-- Базовые скрипты -->
    <script src="/static/js/admin-base.js" defer></script>
    <script>window.showMessage = window.showAdminMessage;</script>

    <!-- Страничные скрипты -->
    {{if eq .PageID "admin-contacts"}}
        {{template "contacts-extra-js" .}}
    {{end}}
    {{if eq .PageID "admin-projects"}}
        {{template "projects-extra-js" .}}
    {{end}}
    {{if eq .PageID "admin-prices"}}
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js" defer></script>
        <script src="/static/js/crop-editor-core.js" defer></script>
        <script src="/static/js/crop-editor-ui.js" defer></script>
        <script src="/static/js/crop-editor-presets.js" defer></script>
        <script src="/static/js/crop-editor-api.js" defer></script>
        <script src="/static/js/admin-prices-images.js" defer></script>
        <script src="/static/js/admin-prices.js" defer></script>
    {{end}}
    {{if eq .PageID "admin-contacts-archive"}}
        {{template "contacts-archive-extra-js" .}}
    {{end}}
    {{if eq .PageID "admin-map-points"}}
        <script src="https://api-maps.yandex.ru/2.1/?apikey=7dfc2fa2-8cbd-465a-8101-0a9ce00d82c5&lang=ru_RU"></script>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js" defer></script>
        <script src="/static/js/admin-map-points.js" defer></script>
    {{end}}

    {{define "contacts-table-head-inbox"}}
    <thead>
    <tr>
        <th class="col-width-select">
        <input type="checkbox" id="select-all" aria-label="Выбрать все на странице">
        </th>
        <th class="col-width-16">Имя</th>
        <th class="col-width-22">Контакты</th>
        <th>Компания</th>
        <th class="col-width-16">Тип</th>
        <th class="col-width-12">Статус</th>
        <th class="col-width-14">Действия</th>
    </tr>
    </thead>
    {{end}}

    {{define "contacts-table-head-archive"}}
    <thead>
    <tr>
        <th class="col-width-select">
        <input type="checkbox" id="select-all" aria-label="Выбрать все на странице">
        </th>
        <th class="col-width-16">Имя</th>
        <th class="col-width-22">Контакты</th>
        <th>Компания</th>
        <th class="col-width-16">Тип</th>
        <th class="col-width-12">Дата</th>
        <th class="col-width-14">Действия</th>
    </tr>
    </thead>
    {{end}}

    {{define "contacts-pagination-inbox"}}
    <div class="pagination">
    <a class="btn btn-small"
        href="?page={{.prevPage}}&limit={{.limit}}{{if .search}}&search={{.search}}{{end}}{{if .status}}&status={{.status}}{{end}}{{if .dateRange}}&date={{.dateRange}}{{end}}{{if .reminder}}&reminder={{.reminder}}{{end}}"
        {{if le .page 1}}aria-disabled="true" tabindex="-1"{{end}}>
        Назад
    </a>

    <div class="page-numbers">
        {{ $cur := .page }} {{ $lim := .limit }} {{ $search := .search }} {{ $status := .status }} {{ $date := .dateRange }}
        {{ range .pageNumbers }}
        {{ if eq . -1 }}
            <span class="dots">…</span>
        {{ else }}
            <a class="page-link {{if eq . $cur}}active{{end}}"
            href="?page={{.}}&limit={{$lim}}{{if $search}}&search={{$search}}{{end}}{{if $status}}&status={{$status}}{{end}}{{if $date}}&date={{$date}}{{end}}{{if $.reminder}}&reminder={{$.reminder}}{{end}}">
            {{.}}
            </a>
        {{ end }}
        {{ end }}
    </div>

    <a class="btn btn-small"
        href="?page={{.nextPage}}&limit={{.limit}}{{if .search}}&search={{.search}}{{end}}{{if .status}}&status={{.status}}{{end}}{{if .dateRange}}&date={{.dateRange}}{{end}}{{if .reminder}}&reminder={{.reminder}}{{end}}"
        {{if ge .page .pages}}aria-disabled="true" tabindex="-1"{{end}}>
        Вперёд
    </a>
    </div>
    {{end}}


    {{define "contacts-pagination-archive"}}
    <div class="pagination">
    <a class="btn btn-small"
        href="?page={{.prevPage}}&limit={{.limit}}{{if .search}}&search={{.search}}{{end}}{{if .dateRange}}&date={{.dateRange}}{{end}}"
        {{if le .page 1}}aria-disabled="true" tabindex="-1"{{end}}>
        Назад
    </a>

    <div class="page-numbers">
        {{ $cur := .page }} {{ $lim := .limit }} {{ $search := .search }} {{ $date := .dateRange }}
        {{ range .pageNumbers }}
        {{ if eq . -1 }}
            <span class="dots">…</span>
        {{ else }}
            <a class="page-link {{if eq . $cur}}active{{end}}"
            href="?page={{.}}&limit={{$lim}}{{if $search}}&search={{$search}}{{end}}{{if $date}}&date={{$date}}{{end}}">
            {{.}}
            </a>
        {{ end }}
        {{ end }}
    </div>

    <a class="btn btn-small"
        href="?page={{.nextPage}}&limit={{.limit}}{{if .search}}&search={{.search}}{{end}}{{if .dateRange}}&date={{.dateRange}}{{end}}"
        {{if ge .page .pages}}aria-disabled="true" tabindex="-1"{{end}}>
        Вперёд
    </a>
    </div>
    {{end}}

</body>
</html>
