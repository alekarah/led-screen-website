<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏ -->
    <link rel="stylesheet" href="/static/css/admin-base.css">
    <link rel="stylesheet" href="/static/css/admin-forms.css">
    <link rel="stylesheet" href="/static/css/admin-projects.css">
    <link rel="stylesheet" href="/static/css/admin-modals.css">
    <link rel="stylesheet" href="/static/css/crop-editor.css">
    
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    {{block "extra-css" .}}{{end}}
</head>
<body>
    <!-- –®–∞–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏ -->
    <div class="header">
        <div class="container">
            <h1>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1>
            <ul class="nav-links">
                <li><a href="/admin">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/admin/projects">–ü—Ä–æ–µ–∫—Ç—ã</a></li>
                <li><a href="/">–ù–∞ —Å–∞–π—Ç</a></li>
            </ul>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container">
        <div id="message"></div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        {{template "admin-content" .}}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü) -->
    {{block "modals" .}}{{end}}

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="/static/js/admin-base.js"></script>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Drag & Drop
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    -->

    <!-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º showMessage –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ -->
    <script>
    window.showMessage = window.showAdminMessage;
    console.log('‚úÖ showMessage –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–∞ showAdminMessage');

    // –ü–†–û–í–ï–†–Ø–ï–ú –ó–ê–ì–†–£–ó–ö–£ SORTABLE
    setTimeout(() => {
        console.log('üîß Sortable –¥–æ—Å—Ç—É–ø–µ–Ω?', typeof Sortable);
        if (typeof Sortable !== 'undefined') {
            console.log('‚úÖ Sortable –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
        } else {
            console.error('‚ùå Sortable –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
        }
    }, 100);
    </script>

    <!-- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    {{block "extra-js" .}}{{end}}

<!-- –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –°–ö–†–ò–ü–¢–û–í –ê–î–ú–ò–ù–ö–ò -->
<script>
if (window.location.pathname.includes('/admin/projects')) {
    console.log('üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∞–¥–º–∏–Ω–∫–∏...');
    
    // –ë–õ–û–ö–ò–†–£–ï–ú contact-form.js –í –ê–î–ú–ò–ù–ö–ï
    const contactScript = document.querySelector('script[src*="contact-form.js"]');
    if (contactScript) {
        contactScript.remove();
        console.log('‚ùå contact-form.js —É–¥–∞–ª–µ–Ω –∏–∑ –∞–¥–º–∏–Ω–∫–∏');
    }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É contact-form.js
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
                if (node.tagName === 'SCRIPT' && node.src && node.src.includes('contact-form.js')) {
                    node.remove();
                    console.log('‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ contact-form.js');
                }
            });
        });
    });
    observer.observe(document.head, { childList: true });
    observer.observe(document.body, { childList: true });
    
    const scripts = [
        '/static/js/admin-projects-creation.js',
        '/static/js/admin-projects-editing.js',
        '/static/js/admin-projects-images.js',
        '/static/js/crop-editor-core.js',
        '/static/js/crop-editor-ui.js',
        '/static/js/crop-editor-presets.js',
        '/static/js/crop-editor-api.js',
//        '/static/js/project-sorting.js'
    ];
    
    let loadedCount = 0;
    
    scripts.forEach(src => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
            loadedCount++;
            console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω (${loadedCount}/${scripts.length}):`, src);
            
            if (loadedCount === scripts.length) {
                console.log('üéâ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é...');
                
                // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –í–´–ó–´–í–ê–ï–ú –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ
                setTimeout(() => {
                    if (typeof initProjectCreation === 'function') {
                        initProjectCreation();
                        console.log('‚úÖ initProjectCreation –≤—ã–∑–≤–∞–Ω');
                    }
                    if (typeof initImageUpload === 'function') {
                        initImageUpload();
                        console.log('‚úÖ initImageUpload –≤—ã–∑–≤–∞–Ω');
                    }
                    if (typeof initImagePreview === 'function') {
                        initImagePreview();
                        console.log('‚úÖ initImagePreview –≤—ã–∑–≤–∞–Ω');
                    }

                    if (typeof initProjectSorting === 'function') {
                        initProjectSorting();
                        console.log('‚úÖ initProjectSorting –≤—ã–∑–≤–∞–Ω');
                    } else {
                        console.log('‚ùå initProjectSorting –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ...');
                        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
                        setTimeout(() => {
                            const container = document.getElementById('sortable-projects');
                            if (container && typeof Sortable !== 'undefined') {
                                window.sortableInstance = Sortable.create(container, {
                                    handle: '.drag-handle',
                                    animation: 150,
                                    ghostClass: 'sortable-ghost',
                                    chosenClass: 'sortable-chosen',
                                    onEnd: function(evt) {
                                        console.log('–ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω:', evt.oldIndex, '‚Üí', evt.newIndex);
                                    }
                                });
                                console.log('‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞');
                            }
                        }, 300);
                    }
                    
                    // –ò–°–ü–†–ê–í–õ–Ø–ï–ú –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ù–ê –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–ï
                    setTimeout(() => {
                        const thumbnailImages = document.querySelectorAll('.project-thumbnail img');
                        console.log('üñºÔ∏è –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä:', thumbnailImages.length);
                        
                        thumbnailImages.forEach((img, index) => {
                            const currentTransform = img.style.transform;
                            
                            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ transform
                            const scaleMatch = currentTransform.match(/scale\(([\d.]+)\)/);
                            const translateMatch = currentTransform.match(/translate\(([\d.-]+)%, ([\d.-]+)%\)/);
                            
                            if (scaleMatch && translateMatch) {
                                const scale = parseFloat(scaleMatch[1]);
                                const rawX = parseFloat(translateMatch[1]);
                                const rawY = parseFloat(translateMatch[2]);
                                
                                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è: –µ—Å–ª–∏ —ç—Ç–æ —Å—ã—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ë–î (0-100), —Ç–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º
                                const translateX = (rawX - 50) * 2;
                                const translateY = (rawY - 50) * 2;
                                
                                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π transform
                                img.style.transform = `scale(${scale}) translate(${translateX}%, ${translateY}%)`;
                                
                                console.log(`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index}: ${rawX},${rawY} ‚Üí ${translateX}%,${translateY}%`);
                            }
                        });
                    }, 200);
                    
                }, 100);
            }
        };
        script.onerror = () => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', src);
        document.head.appendChild(script);
    });
}
</script>
</body>
</html>