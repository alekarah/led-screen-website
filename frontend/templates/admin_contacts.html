{{define "admin-contacts-content"}}
  <div class="form-section contacts-page">
    <h2>
      Все заявки
      <span class="count-big">{{.total}}</span>
    </h2>
    <div class="filters contacts-toolbar">
      <!-- Поиск -->
      <input type="text" id="search-input" class="form-input" placeholder="Поиск" value="{{.search}}">

      <!-- Статус -->
      <select id="status-filter" class="form-input">
        <option value="">Все статусы</option>
        <option value="new" {{if eq .status "new"}}selected{{end}}>Новые</option>
        <option value="processed" {{if eq .status "processed"}}selected{{end}}>Обработанные</option>
      </select>

      <!-- Интервал дат -->
      <select id="date-filter" class="form-input">
        <option value="">Все даты</option>
        <option value="today" {{if eq .dateRange "today"}}selected{{end}}>Сегодня</option>
        <option value="7d" {{if eq .dateRange "7d"}}selected{{end}}>Последние 7 дней</option>
        <option value="month" {{if eq .dateRange "month"}}selected{{end}}>Этот месяц</option>
      </select>

      <select id="filter-reminder" class="form-input">
        <option value="">Все напоминания</option>
        <option value="today"    {{if eq .reminder "today"}}selected{{end}}>Сегодня</option>
        <option value="overdue"  {{if eq .reminder "overdue"}}selected{{end}}>Просрочено</option>
        <option value="upcoming" {{if eq .reminder "upcoming"}}selected{{end}}>Будущие</option>
      </select>

      <!-- Селектор размера страницы -->
      <select id="limit-select" class="form-input">
        <option value="25" {{if eq .limit 25}}selected{{end}}>25</option>
        <option value="50" {{if eq .limit 50}}selected{{end}}>50</option>
        <option value="100" {{if eq .limit 100}}selected{{end}}>100</option>
      </select>

      <div class="toolbar-actions">
        <button id="apply-filters" type="button" class="btn btn-small btn-blue">Применить</button>
        <button id="export-csv" class="btn btn-small">Экспорт CSV</button>
        <button id="go-archive" type="button" class="btn btn-small"
          href="/admin/contacts/archive?{{if .search}}search={{.search}}&{{end}}{{if .dateRange}}date={{.dateRange}}&{{end}}{{if .limit}}limit={{.limit}}&{{end}}status=archived&page=1">
          Архив
        </button>
      </div>

    </div>

    <!-- Панель массовых действий -->
    <div class="bulk-actions">
      <div class="bulk-actions__title">Действия с выбранными:</div>
      <button id="bulk-process" class="btn btn-small" disabled>Обработать</button>
      <button id="bulk-restore" class="btn btn-small btn-blue" disabled>Вернуть в новые</button>
      <button id="bulk-archive" class="btn btn-small" disabled>Архивировать</button>
      <span id="bulk-count" class="muted" style="margin-left:8px;">Выбрано: 0</span>
    </div>

    <div class="table-wrapper">
      <table class="table contacts-table">
        {{template "contacts-table-head-inbox" .}}

        <tbody>
          {{if .contactsAll}}
            {{range .contactsAll}}
              <tr data-id="{{.ID}}">
                <td class="col-select">
                  <input type="checkbox" class="row-select" value="{{.ID}}" aria-label="Выбрать заявку {{.ID}}">
                </td>

                <td>{{.Name}}</td>

                <td>
                  {{if .Phone}}<a href="tel:{{.Phone}}">{{.Phone}}</a>{{else}}—{{end}}
                  <div style="color:#777;">{{.Email}}</div>
                </td>

                <td>{{.Company}}</td>
                <td>{{.ProjectType}}</td>

                <td class="status-cell">
                  {{if eq .Status "processed"}}
                    <span class="badge badge-ok">Обработано</span>
                  {{else if eq .Status "archived"}}
                    <span class="badge">В архиве</span>
                  {{else}}
                    <button class="btn btn-small mark-done" type="button">Обработать</button>
                  {{end}}
                </td>

                <td class="actions">
                  <button
                    class="btn btn-small js-contact-details"
                    type="button"
                    data-id="{{.ID}}"
                    data-name="{{.Name}}"
                    data-phone="{{.Phone}}"
                    data-email="{{.Email}}"
                    data-company="{{.Company}}"
                    data-type="{{.ProjectType}}"
                    data-message="{{.Message}}"
                    data-date="{{fmtTime .CreatedAt}}"
                    data-status="{{.Status}}"
                    data-remind-at='{{with .RemindAt}}{{.Format "2006-01-02T15:04"}}{{end}}'
                    data-remind-flag='{{.RemindFlag}}'
                  >Подробнее</button>
                </td>
              </tr>
            {{end}}
          {{else}}
            <tr><td colspan="7" style="color:#777;">Пока нет заявок</td></tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Пагинация -->
  {{template "contacts-pagination-inbox" .}}
{{end}}

{{define "contacts-modals"}}
  <!-- Модалка деталей заявки -->
  <div id="contact-details-modal" class="modal-overlay hidden" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="contactDetailsTitle">
      <button class="modal-close" type="button" aria-label="Закрыть">&times;</button>

      <h3 id="contactDetailsTitle">Заявка</h3>

      <div class="modal-body">
        <!-- Табы -->
        <div class="tabs">
          <button id="tab-info-btn"  class="btn btn-small btn-blue" type="button">Информация</button>
          <button id="tab-notes-btn" class="btn btn-small"          type="button">Заметки</button>
        </div>

        <!-- TAB: Информация -->
        <div id="cd-tab-info">
          <div class="modal-grid">
            <div><strong>Имя:</strong> <span id="cd-name">—</span></div>
            <div><strong>Телефон:</strong> <a id="cd-phone" href="#" target="_blank">—</a></div>
            <div><strong>Email:</strong> <a id="cd-email" href="#" target="_blank">—</a></div>
            <div><strong>Компания:</strong> <span id="cd-company">—</span></div>
            <div><strong>Тип проекта:</strong> <span id="cd-type">—</span></div>
            <div><strong>Дата:</strong> <span id="cd-date">—</span></div>
            <div><strong>Статус:</strong> <span id="cd-status" class="badge">—</span></div>
          </div>

          <div class="modal-message">
            <strong>Сообщение:</strong>
            <div id="cd-message" class="prewrap"></div>
          </div>

          <div class="modal-footer" style="margin-top:16px;">
            <button id="cd-mark-processed" class="btn btn-small btn-success">Обработать</button>
            <button id="cd-mark-new"       class="btn btn-small btn-blue">Вернуть в новые</button>
            <button id="cd-archive"        class="btn btn-small btn-danger">Архивировать</button>
          </div>
        </div>

        <!-- TAB: Заметки -->
        <div id="cd-tab-notes" class="hidden">
          <!-- Напоминание -->
          <div class="reminder-block">
            <strong>Перезвонить позже:</strong>
            <div class="reminder-row">
              <input id="cd-remind-at" type="datetime-local" class="form-input" style="max-width:220px;">
              <button id="cd-reminder-save"  class="btn btn-small btn-blue"  type="button">Сохранить</button>
              <button id="cd-reminder-clear" class="btn btn-small btn-danger" type="button">Очистить</button>
            </div>
          </div>

          <!-- Список заметок -->
          <div style="margin-top:12px;">
            <strong>Заметки:</strong>
            <ul id="cd-notes-list" class="notes-list"></ul>

            <div class="notes-controls">
              <input id="cd-note-author" type="text" class="form-input" placeholder="Автор (необязательно)" style="max-width:220px;">
              <input id="cd-note-text"   type="text" class="form-input" placeholder="Новая заметка..." style="flex:1; min-width:240px;">
              <button id="cd-note-add"   class="btn btn-small btn-blue" type="button">Добавить</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{{end}}

{{define "contacts-extra-js"}}
  <script src="/static/js/admin-contacts-api.js" defer></script>
  <script src="/static/js/admin-contacts-ui.js" defer></script>
  <script src="/static/js/admin-contacts-shared.js" defer></script>
  <script src="/static/js/admin-contacts-filters.js" defer></script>
  <script src="/static/js/admin-contacts-notes.js"></script>
  <script src="/static/js/admin-contacts-modal.js" defer></script>
  <script src="/static/js/admin-contacts-bulk.js" defer></script>
  <script src="/static/js/admin-contacts-init.js" defer></script>
{{end}}

